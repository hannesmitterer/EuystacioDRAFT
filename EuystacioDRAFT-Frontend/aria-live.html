<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibility Support - EuystacioDRAFT</title>
    <style>
        /* Accessibility live region styles */
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }
        
        .aria-live-region {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            * {
                border-color: currentColor !important;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus indicators */
        :focus {
            outline: 2px solid #4A773C;
            outline-offset: 2px;
        }
        
        /* Skip links */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #4A773C;
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
        }
        
        .skip-link:focus {
            top: 6px;
        }
    </style>
</head>
<body>
    <!-- Skip navigation link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Primary live region for important announcements -->
    <div id="aria-live-primary" class="aria-live-region" aria-live="assertive" aria-atomic="true" role="status">
    </div>
    
    <!-- Secondary live region for general updates -->
    <div id="aria-live-secondary" class="aria-live-region" aria-live="polite" aria-atomic="false" role="log">
    </div>
    
    <!-- Status region for connection and system status -->
    <div id="aria-live-status" class="aria-live-region" aria-live="polite" aria-atomic="true" role="status">
    </div>
    
    <!-- Screen reader only content -->
    <div class="sr-only">
        <h1>EuystacioDRAFT Accessibility Features</h1>
        <p>This page provides accessibility support for the EuystacioDRAFT sacred bridge interface.</p>
        
        <h2>Keyboard Navigation</h2>
        <ul>
            <li>Tab: Navigate through interactive elements</li>
            <li>Enter/Space: Activate buttons and links</li>
            <li>Arrow keys: Navigate within components</li>
            <li>Escape: Close dialogs and return to main content</li>
            <li>Alt + 1-4: Quick navigation between main sections</li>
            <li>Alt + P: Play hymn audio (on hymn page)</li>
            <li>Alt + G: Show hymn guide (on hymn page)</li>
            <li>Alt + D: Download hymn text (on hymn page)</li>
            <li>1-3: Switch dashboard views (on dashboard page)</li>
        </ul>
        
        <h2>Screen Reader Support</h2>
        <p>
            All interactive elements have appropriate ARIA labels and descriptions. 
            Live regions announce important changes and updates. 
            Form fields include helpful descriptions and validation messages.
        </p>
        
        <h2>Visual Accessibility</h2>
        <p>
            The interface supports high contrast mode, reduced motion preferences, 
            and includes focus indicators for keyboard navigation. 
            All colors meet WCAG AA contrast requirements.
        </p>
        
        <h2>Emergency Accessibility</h2>
        <p>
            If you encounter accessibility barriers, use the following fallback options:
        </p>
        <ul>
            <li>Text-only version: Add ?text=true to any URL</li>
            <li>High contrast: Add ?contrast=high to any URL</li>
            <li>No animations: Add ?motion=reduce to any URL</li>
        </ul>
    </div>
    
    <!-- Accessibility utility functions -->
    <script>
        // Global accessibility functions
        window.accessibilityUtils = {
            // Announce to screen readers
            announce: function(message, priority = 'polite') {
                const regionId = priority === 'assertive' ? 'aria-live-primary' : 'aria-live-secondary';
                const region = document.getElementById(regionId);
                if (region) {
                    region.textContent = message;
                    // Clear after announcement to avoid repetition
                    setTimeout(() => {
                        region.textContent = '';
                    }, 1000);
                }
            },
            
            // Update status
            updateStatus: function(status) {
                const statusRegion = document.getElementById('aria-live-status');
                if (statusRegion) {
                    statusRegion.textContent = status;
                }
            },
            
            // Focus management
            focusElement: function(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.focus();
                    this.announce(`Focused on ${element.getAttribute('aria-label') || element.textContent || elementId}`);
                }
            },
            
            // Skip to content
            skipToContent: function() {
                const mainContent = document.getElementById('main-content') || document.querySelector('main');
                if (mainContent) {
                    mainContent.scrollIntoView();
                    mainContent.focus();
                    this.announce('Skipped to main content');
                }
            },
            
            // Apply accessibility preferences from URL parameters
            applyPreferences: function() {
                const urlParams = new URLSearchParams(window.location.search);
                
                if (urlParams.get('contrast') === 'high') {
                    document.body.classList.add('high-contrast');
                }
                
                if (urlParams.get('motion') === 'reduce') {
                    document.body.classList.add('reduce-motion');
                }
                
                if (urlParams.get('text') === 'true') {
                    document.body.classList.add('text-only');
                }
                
                // Apply font size preference
                const fontSize = urlParams.get('font-size');
                if (fontSize && ['small', 'medium', 'large', 'extra-large'].includes(fontSize)) {
                    document.body.classList.add(`font-${fontSize}`);
                }
            },
            
            // Keyboard shortcuts handler
            handleKeyboardShortcuts: function(event) {
                if (event.altKey) {
                    switch(event.key) {
                        case '1':
                            event.preventDefault();
                            window.location.href = 'index.html';
                            break;
                        case '2':
                            event.preventDefault();
                            window.location.href = 'connect.html';
                            break;
                        case '3':
                            event.preventDefault();
                            window.location.href = 'dashboard.html';
                            break;
                        case '4':
                            event.preventDefault();
                            window.location.href = 'hymn.html';
                            break;
                        case 'h':
                            event.preventDefault();
                            this.showKeyboardHelp();
                            break;
                    }
                }
                
                if (event.key === 'Escape') {
                    // Close any open dialogs or return focus to main content
                    this.skipToContent();
                }
            },
            
            // Show keyboard help
            showKeyboardHelp: function() {
                const helpText = `
EUYSTACIO KEYBOARD SHORTCUTS

Navigation:
Alt + 1: Home page
Alt + 2: Connect page  
Alt + 3: Dashboard page
Alt + 4: Sacred Hymn page
Alt + H: Show this help

Dashboard:
1: Overview view
2: Harmonic view
3: Sacred view

Hymn Page:
Alt + P: Play hymn
Alt + G: Singing guide
Alt + D: Download text

General:
Tab: Next element
Shift + Tab: Previous element
Enter/Space: Activate
Escape: Close/Return to main
                `;
                
                alert(helpText);
                this.announce('Keyboard shortcuts help displayed');
            }
        };
        
        // Initialize accessibility features
        document.addEventListener('DOMContentLoaded', () => {
            window.accessibilityUtils.applyPreferences();
            
            // Set up keyboard shortcuts
            document.addEventListener('keydown', (event) => {
                window.accessibilityUtils.handleKeyboardShortcuts(event);
            });
            
            // Announce page load
            window.accessibilityUtils.announce('EuystacioDRAFT accessibility features loaded');
        });
        
        // Override the global updateAriaLive function to use our enhanced system
        if (typeof window !== 'undefined') {
            window.updateAriaLive = function(message, priority = 'polite') {
                window.accessibilityUtils.announce(message, priority);
            };
        }
    </script>
</body>
</html>